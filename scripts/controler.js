import{C as f,i as R}from"./ControllerBase-f6d04901.js";const x=async s=>await new Promise(e=>setTimeout(()=>{e(s)},s)),K=(s,e)=>{let t=0;return{debounce:()=>{clearTimeout(t),t=setTimeout(s,e)}}},p=async(s,e,t=1,r=0,o=!1)=>{let i=null,a;for(;t>0;)try{if(a=await fetch(s,e),!a.ok)throw new Error(a.status.toString());i=a,t=0}catch{t-=1,r>0&&await x(r)}if(i===null&&!o)throw new Error("Request has failed");return i===null&&o?a:i},Q=(s,e)=>{const t=s.getBoundingClientRect(),r=document.body,o=document.documentElement,i=window.pageYOffset||o.scrollTop||r.scrollTop,a=window.pageXOffset||o.scrollLeft||r.scrollLeft,c=o.clientTop||r.clientTop||0,l=o.clientLeft||r.clientLeft||0,_=t.top+i-c,T=t.left+a-l;return e===!0?{top:_,left:T,width:t.width,height:t.height}:{top:_,left:T}};let g=-1;const X=()=>{if(g>-1)return g;const s=document.createElement("div");s.style.visibility="hidden",s.style.overflow="scroll",s.style.msOverflowStyle="scrollbar",document.body.appendChild(s);const e=document.createElement("div");return s.appendChild(e),g=s.offsetWidth-e.offsetWidth,s.parentNode.removeChild(s),g},v=document.createElement("div"),M=s=>(v.innerHTML=s,v.firstElementChild.cloneNode(!0)),J=s=>{const e=window.innerWidth||document.documentElement.clientWidth,t=window.innerHeight||document.documentElement.clientHeight,r=s.top<t&&s.bottom>0&&s.left<e&&s.right>0;let o="outside_viewport",i="outside_viewport";return r&&(s.bottom<=t/3?o="top":s.top>=t/3*2?o="bottom":o="middle",s.right<=e/3?i="left":s.left>=e/3*2?i="right":i="center"),{verticalPosition:o,horizontalPosition:i}},Y=s=>{let e=s;for(;e&&e.nodeType!==Node.ELEMENT_NODE;)e=e.parentElement;return e instanceof Element?e.getBoundingClientRect():new DOMRect},V=s=>{const e=[];s.forEach(c=>{c.nodeType===Node.TEXT_NODE?e.push(c.parentElement):c instanceof Element&&e.push(c)});let t=e[0].getBoundingClientRect(),r=t.top,o=t.left,i=t.right,a=t.bottom;return e.forEach(c=>{const l=c.getBoundingClientRect();l.width&&l.height&&(r=Math.min(r,l.top),o=Math.min(o,l.left),i=Math.max(i,l.right),a=Math.max(a,l.bottom))}),new DOMRect(o,r,i-o,a-r)};class I{constructor(e,t=0,r=void 0){this._view=new Uint16Array(e,t*2,r)}set(e){for(let t=0;t<this._view.length;t++)this._view[t]=e.charCodeAt(t)||0;return this}toString(){return String.fromCharCode(...this._view)}}class ee{constructor(e){e=e??"",this._buffer=new ArrayBuffer((e==null?void 0:e.length)*2),this.getView().set(e)}getView(e=0,t){return new I(this._buffer,e,t)}toString(){return this.getView().toString()}}const te=s=>s&&typeof s=="string"?s.trim().length:0,se=s=>/^[a-z0-9\-]+$/.test(s)?s:s.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/([a-zA-Z])(\d)/g,"$1-$2").replace(/[\s_]+/g,"-").toLowerCase();class O extends HTMLElement{constructor(){super(...arguments),this.events={},this.on=(e,t)=>{if(!t||typeof t!="function")for(const r of this.events[e])r(t);else this.events[e]=this.events[e]?[...this.events[e],t]:[t]}}_init(){}_registerListeners(){}_getPluginsList(){return[]}connectedCallback(){this._init(),this._registerListeners();for(const e of this._getPluginsList())e.apply(this)}disconnectedCallback(){}}O.registerDOMPart=(s,e,t,r)=>{const o=document.createElement(t??"div");return o.id=s,e instanceof HTMLElement?e.insertAdjacentElement(r??"beforeend",o):e.appendChild(o),o};const re=(s,e,t)=>e-t<=s&&e+t>=s,oe=(s,e,t)=>Math.min(t,Math.max(e,s)),ie=(s,e)=>s/e*100,ne=s=>s*Math.PI/180,ae=(s,e=100)=>{let t;return(...r)=>{t&&clearTimeout(t),t=setTimeout(()=>{s.apply(null,r)},e)}};let S=class{async getLoadTime(e){if(!e)throw new Error("csrf is not defined");const r=await(await p("https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/get-current-time",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e}})).json();if(!r.currentTime)throw new Error("Something went wrong");return r.currentTime}async getLastSaveTime(e){if(!e)throw new Error("csrf is not defined");const r=await(await p("https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/get-current-time",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":e}})).json();if(!r.currentTime)throw new Error("Something went wrong");return r.currentTime}async bookLoadedTime(e,t){if(!e)throw new Error("Book ID is not defined");if(!(await(await p(`https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/metrics/book/${e}/open `,{method:"POST",headers:[["Content-Type","application/json"]],body:JSON.stringify({time:t})})).json()).success)throw new Error("Something went wrong")}async bookCompletion(e){if(!e)throw new Error("Book ID is not defined");if(!(await(await p(`https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/metrics/book/${e}/read`,{method:"POST",headers:[["Content-Type","application/json"]]})).json()).success)throw new Error("Something went wrong")}async sendTimeInReader(e){if(!(await(await p("https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/metrics/user/time",{method:"POST",headers:[["Content-Type","application/json"]],body:JSON.stringify({time:e})})).json()).success)throw new Error("Something went wrong")}async sendAuthInit(e){if(!(await(await p(`https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/metrics/auth-init/${e}`,{method:"POST",headers:[["Content-Type","application/json"]]})).json()).success)throw new Error("Something went wrong")}};const P=s=>{const e=new Date().getTime(),t=Math.round((e-s)/1e3/60);if(isNaN(t))throw new Error("Reading time is not defined");return t},B=(s,e)=>{for(const t in s)if(s.hasOwnProperty(t)){if(typeof s[t]=="object"&&typeof e[t]=="object")return Object.keys(A(s[t],e[t])).length===0;if(s[t]!==e[t])return!1}return!0},A=(s,e)=>{const t={};for(const r in s)s.hasOwnProperty(r)&&s[r]!==e[r]&&(t[r]=s[r]);return t},u=(s,e,t,r)=>{const o=i=>{if(r!=null&&!B(r,i))return;const a=t(i);return s.removeEventListener(e,o),a};return s.addEventListener(e,o),()=>s.removeEventListener(e,o)},le=(s,e)=>{const t={bubbles:!0,cancelable:!0,composed:!0},r=new CustomEvent(s,{...t,detail:e});document.dispatchEvent(r)};var m=(s=>(s.HIGHLIGHT_TEXT="highlight-text",s.UPDATE_QUOTE="update-quote",s.DELETE_QUOTE="delete-quote",s.PAGE_LOADED="page-loaded",s.SECTION_LOADED="section-loaded",s.DETECTOR_ELEMENT_CHANGED="detector-element-changed",s.PAGE_MODE_CHANGE="page-mode-change",s.CONFIG_FETCHED="config-fetched",s.PERCENTS_CHANGED="percents-changed",s.PAGE_CHANGED="page-changed",s))(m||{}),w=(s=>(s.ADD_QUOTE_ERROR="An error occurred while creating a quote. The operation was canceled.",s.EDIT_QUOTE_ERROR="An error occurred while editing a quote. The operation was canceled.",s.DELETE_QUOTE_ERROR="An error occurred while deleting a quote. The operation was canceled.",s.GET_QUOTES_ERROR="An error occurred while trying to get a list of quotes for the current file section.",s.QUOTING_UNAVAILABLE_ERROR="Quoting is unavailable because a text modifying plugin is enabled. To use the quote feature, please disable the plugin",s.SYNCHRONIZE_POSITION_ERROR="An error occurred while trying to synchronize with a saved reading position.",s.SAVE_POSITION_ERROR="An error occurred while trying to save the current reading position.",s))(w||{});const b=30,y=80;class n extends f{constructor(){super(...arguments),this.isCompletionMetricAdded=!1,this.intervalId=null}static async getLoadTime(){const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=await n.api.getLoadTime(e);n.pageLoadTime=n.refreshTime=t}static async getLastSaveTime(){const e=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),t=await n.api.getLastSaveTime(e);n.refreshTime=t}_getFrontendStartTime(){this.frontendStartTime=new Date().getTime()}async _handleBookLoadedTime(){const e=this.service.bookMetaInfo.bookId;n.api.bookLoadedTime(e,n.pageLoadTime)}_handleTimeInReader(){this.intervalId!==null&&clearInterval(this.intervalId),this.intervalId=setInterval(()=>{n.api.sendTimeInReader(n.pageLoadTime)},6e4)}_attachPageListeners(){u(document,m.PAGE_LOADED,()=>{this._handleBookLoadedTime()}),document.addEventListener(m.PAGE_CHANGED,e=>{this._handlePageBookCompletion(e.detail)})}_attachFlowListeners(){u(document,m.SECTION_LOADED,()=>{this._handleBookLoadedTime()}),document.addEventListener(m.PERCENTS_CHANGED,e=>{this._handleFlowBookCompletion(e.detail.currentPercents)})}_handleFlowBookCompletion(e){if(this.isCompletionMetricAdded||e<y)return;if(P(this.frontendStartTime)>=b){const r=this.service.bookMetaInfo.bookId;n.api.bookCompletion(r),this.isCompletionMetricAdded=!0}}_handlePageBookCompletion(e){if(!this.totalPagesCount){const o=this.service;this.totalPagesCount=o.totalPagesCount}const t=e/this.totalPagesCount*100>=y;if(this.isCompletionMetricAdded||!t)return;if(P(this.frontendStartTime)>=b){const o=this.service.bookMetaInfo.bookId;n.api.bookCompletion(o),this.isCompletionMetricAdded=!0}}_handleConfigFetched(){switch(this.service.bookMetaInfo.type){case"PAGE":this._attachPageListeners();break;case"FLOW":this._attachFlowListeners();break;default:throw new Error("Book type is not defined")}}_setup(){n.api=new S,n.getLoadTime(),this._getFrontendStartTime(),this._handleTimeInReader()}_attach(){u(document,m.CONFIG_FETCHED,()=>{this._handleConfigFetched()})}}const F=`:host{font-family:Stolzl Book,Helvetica,Arial,sans-serif}.toast-wrapper{position:relative;visibility:hidden;width:100%;min-height:48px;display:flex;justify-content:space-between;align-items:flex-start;justify-items:flex-start;gap:10px;padding:14px 16px;border-radius:2px;border-style:solid;border-width:1px;box-sizing:border-box;zoom:1!important}.toast-wrapper_info{border-color:var(--info);background-color:var(--info-light)}.toast-wrapper_error{border-color:var(--error);background-color:var(--error-light);color:var(--gray-900-night)}.toast-wrapper_warning{border-color:var(--warning);background-color:var(--warning-light)}.toast-wrapper_success{border-color:var(--success);background-color:var(--success-light)}.toast__icon{display:flex;justify-content:center;align-items:center;width:20px;height:20px}.toast__icon_info{width:20px;height:20px;color:var(--info)}.toast__icon_error{width:20px;height:20px;color:var(--error)}.toast__icon_warning{width:20px;height:20px;color:var(--warning)}.toast__icon_success{width:20px;height:20px;color:var(--success)}.toast__message{color:var(--gray-900-day);cursor:default;font-family:Stolzl Book,Helvetica,Arial,sans-serif;font-size:14px;line-height:19.5px;max-height:100px;width:100%;display:flex;flex-direction:column;justify-content:flex-start;justify-items:center;align-items:start;overflow:hidden}.toast__message_clamp{display:-webkit-box;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;line-clamp:3;-webkit-line-clamp:3}.toast__closeBtn{width:16px;height:16px;color:var(--gray-700-day);cursor:pointer;transition:all .2s}.toast__closeBtn:hover{color:var(--gray-800-day);transform:scale(1.15)}.toast__closeBtn:active{color:var(--gray-800-day);transform:scale(.85)}.toast__report-btn{display:inline;border:none;background-color:inherit;font:inherit;color:var(--gray-700-day);text-decoration:underline;text-underline-offset:2px;transition:all .2s;cursor:pointer}.toast__report-btn:hover{color:var(--info)}.toast__report-btn:active{color:var(--press-link)}.toast_show{animation:slideIn .42s cubic-bezier(.08,1.1,.32,1.275) forwards;visibility:visible}.toast_hide{animation:slideOut .42s cubic-bezier(.08,1.1,.32,1.275) forwards}.progress-bar{position:absolute;bottom:0;left:0;height:3px;background-color:var(--gray-900-day);animation:progress linear forwards}.progress-bar_info{background-color:var(--info)}.progress-bar_error{background-color:var(--error)}.progress-bar_warning{background-color:var(--warning)}.progress-bar_success{background-color:var(--success)}.dark-mode.toast-wrapper_info{border-color:var(--info);background-color:var(--blue-highlight-night)}.dark-mode.toast-wrapper_error{border-color:var(--error);background-color:var(--red-highlight-night)}.dark-mode.toast-wrapper_warning{border-color:var(--warning);background-color:var(--yellow-highlight-night)}.dark-mode.toast-wrapper_success{border-color:var(--success);background-color:var(--green-highlight-night)}.dark-mode.toast-wrapper .toast__message{color:var(--gray-900-night)}@keyframes slideIn{0%{transform:translate(100%);opacity:0}to{transform:translate(0);opacity:1}}@keyframes slideOut{0%{transform:translate(0);opacity:1}to{transform:translate(100%);opacity:0}}@keyframes progress{0%{width:100%}to{width:0%}}@media screen and (max-width: 768px){.toast-wrapper{gap:6px;padding:9px 10px}.toast__message{font-size:12px;line-height:auto}.toast__message_clamp{line-clamp:4;-webkit-line-clamp:4}}
`,H=`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM9 13H11V15H9V13ZM9 5H11V11H9V5Z" fill="currentColor"/>
</svg>
`,U=`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM10 8.586L12.828 5.757L14.243 7.172L11.414 10L14.243 12.828L12.828 14.243L10 11.414L7.172 14.243L5.757 12.828L8.586 10L5.757 7.172L7.172 5.757L10 8.586Z" fill="currentColor"/>
</svg>
`,C=`<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20ZM10 18C12.1217 18 14.1566 17.1571 15.6569 15.6569C17.1571 14.1566 18 12.1217 18 10C18 7.87827 17.1571 5.84344 15.6569 4.34315C14.1566 2.84285 12.1217 2 10 2C7.87827 2 5.84344 2.84285 4.34315 4.34315C2.84285 5.84344 2 7.87827 2 10C2 12.1217 2.84285 14.1566 4.34315 15.6569C5.84344 17.1571 7.87827 18 10 18ZM9.003 14L4.76 9.757L6.174 8.343L9.003 11.172L14.659 5.515L16.074 6.929L9.003 14Z" fill="currentColor"/>
</svg>
`,W=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_19981_5213)">
<path d="M7.99999 7.05732L11.3 3.75732L12.2427 4.69999L8.94266 7.99999L12.2427 11.3L11.3 12.2427L7.99999 8.94266L4.69999 12.2427L3.75732 11.3L7.05732 7.99999L3.75732 4.69999L4.69999 3.75732L7.99999 7.05732Z" fill="currentColor"/>
</g>
<defs>
<clipPath id="clip0_19981_5213">
<rect width="16" height="16" fill="white"/>
</clipPath>
</defs>
</svg>
`,L=5e3,j=!0,E=!0,$=!1,N="inform us via the bug report form";class h extends O{constructor(){super(...arguments),this.config=null,this.icons={error:U,warning:H,success:C,info:C}}static create(e){const t=new h;return t.setConfig(e),t}setConfig(e){this.config=e,this.remainingTime=(e==null?void 0:e.toastTimeout)??L,this.isHandleClose=(e==null?void 0:e.isClosable)??j,this.isCloseByTimeout=(e==null?void 0:e.isCloseByTimeout)??E,this.isReportLink=(e==null?void 0:e.isReportLink)??$,!this.isCloseByTimeout&&!this.isHandleClose&&(this.isCloseByTimeout=E,this.remainingTime=L)}_handleRemoveToast(){this.DOMParts.InnerWrapper.addEventListener("animationend",e=>{e.animationName==="slideOut"&&this.remove()}),this.DOMParts.InnerWrapper.classList.add("toast_hide")}_showToast(){const{notificationType:e,message:t}=this.config;this._setIconAndColor(e),this._setMessage(t),this.DOMParts.InnerWrapper.classList.add("toast_show"),this.isCloseByTimeout&&this._startTimer()}_setIconAndColor(e){this.DOMParts.Icon.innerHTML=`<span class="toast__icon_${e}">${this.icons[e]}</span>`,this.DOMParts.InnerWrapper.classList.add(`toast-wrapper_${e}`)}_setMessage(e){if(typeof e=="string"){const t=document.createElement("div");t.classList.add("toast__message_clamp"),t.textContent=e,this.DOMParts.MessageContainer.appendChild(t)}else this.DOMParts.MessageContainer.appendChild(e);this._addReportLink()}_addReportLink(){var r;if(!this.isReportLink||(r=this.config)!=null&&r.isMobile)return;const e=document.createElement("span"),t=document.createElement("button");t.classList.add("toast__report-btn"),t.textContent=N,e.textContent="Please",e.appendChild(t),this.DOMParts.MessageContainer.appendChild(e),t.addEventListener("click",()=>{this._handleRemoveToast(),this.config.onShowFeedbackForm()})}_startTimer(){this.DOMParts.InnerWrapper.addEventListener("mouseenter",()=>this._onPauseTimer()),this.DOMParts.InnerWrapper.addEventListener("mouseleave",()=>this._onResumeTimer()),this.DOMParts.ProgressBar.classList.add(`progress-bar_${this.config.notificationType}`),this.DOMParts.ProgressBar.style.animationDuration=`${this.remainingTime}ms`,this.DOMParts.ProgressBar.style.animationPlayState="running",this.startTime=Date.now(),this.timerId=setTimeout(()=>this._handleRemoveToast(),this.remainingTime)}_onPauseTimer(){if(this.isPaused)return;this.isPaused=!0,clearTimeout(this.timerId);const e=Date.now()-this.startTime;if(this.remainingTime-=e,this.remainingTime&&this.remainingTime<=0){this._handleRemoveToast();return}this.DOMParts.ProgressBar.style.animationPlayState="paused"}_onResumeTimer(){if(this.isPaused){if(this.isPaused=!1,this.startTime=Date.now(),this.remainingTime&&this.remainingTime<=0){this._handleRemoveToast();return}this.timerId=setTimeout(()=>this._handleRemoveToast(),this.remainingTime),this.DOMParts.ProgressBar.style.animationDuration=`${this.remainingTime}ms`,this.DOMParts.ProgressBar.style.animationPlayState="running"}}_init(){const e=this.attachShadow({mode:"open"});this.DOMParts={},this.DOMParts.Style=h.registerDOMPart("style",e,"style"),this.DOMParts.Style.innerText=F,this.DOMParts.InnerWrapper=h.registerDOMPart("innerWrapper",e),this.DOMParts.InnerWrapper.classList.add("toast-wrapper"),this.isCloseByTimeout&&(this.DOMParts.ProgressBar=h.registerDOMPart("progressBar",this.DOMParts.InnerWrapper),this.DOMParts.ProgressBar.classList.add("progress-bar")),this.DOMParts.Icon=h.registerDOMPart("icon",this.DOMParts.InnerWrapper),this.DOMParts.Icon.classList.add("toast__icon"),this.DOMParts.MessageContainer=h.registerDOMPart("messageContainer",this.DOMParts.InnerWrapper),this.DOMParts.MessageContainer.classList.add("toast__message"),this.isHandleClose&&(this.DOMParts.CloseBtn=h.registerDOMPart("closeBtn",this.DOMParts.InnerWrapper),this.DOMParts.CloseBtn.classList.add("toast__closeBtn"),this.DOMParts.CloseBtn.addEventListener("click",()=>this._handleRemoveToast()),this.DOMParts.CloseBtn.innerHTML=`<span>${W}</span>`),this.checkPageTheme(),this._showToast()}connectedCallback(){if(!this.config){this.remove();return}super.connectedCallback()}checkPageTheme(){document.querySelector("body").classList.contains("light-mode")?this.DOMParts.InnerWrapper.classList.add("light-mode"):this.DOMParts.InnerWrapper.classList.add("dark-mode")}}const G=(s,e)=>{if(!e||!s)throw new Error("Toast config or container is not defined");const t=h.create(e);return s.prepend(t),t};customElements.define("notification-toast",h);class d extends f{_setup(){var t,r,o;if(!this.service)return!1;const e=(o=(r=(t=this.service)==null?void 0:t.controllers)==null?void 0:r.feedbackController)==null?void 0:o.showFeedbackForm;d.isMobile=R(),d.onShowFeedbackForm=e??(()=>{})}_attach(){this._createTostContainer(),super._attach()}_createTostContainer(){d.toastContainer=M(`
            <div class="toastContainer"></div>
            `),document.body.appendChild(d.toastContainer)}static createTost(e){if(!d.toastContainer)throw new Error("Toast container is not defined");G(d.toastContainer,{...e,isMobile:d.isMobile,onShowFeedbackForm:d.onShowFeedbackForm})}}class Z{async getPosition({bookId:e,csrfToken:t}){const r=`https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/get-position?book_id=${encodeURIComponent(e)}`;return await(await p(r,{headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t}})).json()}async savePosition({bookId:e,csrfToken:t,progress:r,refreshTime:o}){const i=JSON.stringify({book_id:e,progress:r,refresh_time:o});return p("https://sabdaliterasi.xyz/api/fetch/https://reader.z-library.sk/api/save-position",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t},keepalive:!0,body:i})}}const k=class D extends f{static async getPositions(e,t){let r;try{r=await this.api.getPosition({bookId:e,csrfToken:t})}catch{throw d.createTost({notificationType:"error",message:w.SYNCHRONIZE_POSITION_ERROR,isReportLink:!0}),new Error("Get position error")}return this.positions=r,r}static async getAndGoToLastPage(e,t,r,o){var l;const i=await this.getPositions(e==null?void 0:e.bookId,t),c=((l=i==null?void 0:i.primary_position)==null?void 0:l.progress)??1;return o&&o.currentPagesElement&&(o.currentPagesElement.innerHTML=c>r?r.toString():c.toString()),c}static async saveLastPage(e,t,r){try{await this.api.savePosition({bookId:e==null?void 0:e.bookId,progress:t,refreshTime:n.refreshTime,csrfToken:r})}catch{throw d.createTost({notificationType:"error",message:w.SAVE_POSITION_ERROR,isReportLink:!0}),new Error("Get position error")}}static getLastPageForUnAuth(){const e=window.readerService.bookConnectionInfo.source;if(e){const t=JSON.parse(localStorage.getItem(`lastPage_${e}`));return t||1}return 1}static setLastPageForUnAuth(e){const t=window.readerService.bookConnectionInfo.source;if(t){const r=`lastPage_${t}`;localStorage.setItem(r,JSON.stringify(e))}}static clearLastPageForUnAuth(){const e=window.readerService.bookConnectionInfo.source;e&&localStorage.removeItem(`lastPage_${e}`)}static redirectToProgressFromUrlPdf(){const e=this.getProgressFromUrl();if(e)return globalThis==null||globalThis.IDRViewer.goToPage(e),this._removeProgressFromUrl(),e}static redirectToProgressFromUrlOeb(){const e=this.getProgressFromUrl();if(e)return this._removeProgressFromUrl(),e}static getProgressFromUrl(){const e=new URLSearchParams(window.location.search),t=parseInt(e.get("progress"));return isNaN(t)?0:t}static _removeProgressFromUrl(){const e=new URL(window.location.href);e.searchParams.delete("progress"),window.history.replaceState({},"",e.toString())}_setup(){D.api=new Z}};k.positions=null;let de=k;export{m as C,n as M,w as N,de as P,ee as S,d as T,Y as a,V as b,M as c,K as d,ne as e,te as f,X as g,J as h,O as i,le as j,Q as k,se as l,oe as m,re as n,u as o,ie as p,p as r,ae as w};
